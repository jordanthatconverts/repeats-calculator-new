<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RepEats Revenue Calculator — Dynamic Offers</title>
<style>
  :root{--bg:#0b0d10;--card:#11151a;--muted:#9fb0c3;--text:#e8edf4;--brand:#7c5cff;--brand2:#00e5a8}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b0d10,#0e1217);color:var(--text);font:400 16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter}
  .container{max-width:1000px;margin:28px auto;padding:0 20px}
  h1{margin:0 0 6px;font-size:28px} p.muted{color:var(--muted);margin:0 0 14px}
  .grid{display:grid;gap:16px} .cols-2{grid-template-columns:1.1fr .9fr} @media(max-width:980px){.cols-2{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px}
  label{font-size:14px;display:block;margin-bottom:6px;color:#cfe0f0} input,select{width:100%;background:#0f1318;color:var(--text);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:10px 12px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px} .row > div{display:flex;flex-direction:column}
  .table{width:100%;border-collapse:separate;border-spacing:0} .table th,.table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);text-align:right}
  .table th:first-child,.table td:first-child{text-align:left} .table th{color:var(--muted);font-weight:600;font-size:13px}
  .kpis{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px} @media(max-width:820px){.kpis{grid-template-columns:repeat(2,minmax(0,1fr))}}
  .kpi{background:#0f1318;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
  .kpi .label{color:var(--muted);font-size:12px} .kpi .val{font-size:20px;margin-top:2px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#0b0d10;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  button.secondary{background:#0f1318;color:var(--text);border:1px solid rgba(255,255,255,.10)}
  .del{background:#261a3f;color:#ffdede;border:1px solid rgba(255,0,0,.25)}
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <h1>RepEats Revenue Calculator</h1>
  <p class="muted">Set accounts, posting volume, views, CTR & CVR. Add/remove offers freely — we’ll normalise the mix and compute clicks, orders, £/1,000 views, and revenue.</p>

  <div class="grid cols-2">
    <section class="card">
      <h2>Inputs</h2>
      <div class="row">
        <div><label>Active Accounts Posting</label><input id="accounts" type="number" min="0" step="1" value="6"></div>
        <div><label>Posts per Month (per account)</label><input id="ppm" type="number" min="0" step="1" value="60"></div>
      </div>
      <div class="row">
        <div><label>Views per Post</label><input id="viewsPerPost" type="number" min="0" step="100" value="10000"></div>
        <div><label>Total Monthly Views (override)</label><input id="monthlyViews" type="number" min="0" step="1000" value="0"></div>
      </div>
      <div class="row">
        <div><label>CTR (decimal or %)</label><input id="ctr" type="number" step="0.001" value="0.01"></div>
        <div><label>CVR (decimal or %)</label><input id="cvr" type="number" step="0.001" value="0.02"></div>
      </div>
      <div class="toolbar">
        <button id="save">Save</button>
        <button id="load" class="secondary">Load</button>
        <button id="reset" class="secondary">Reset</button>
      </div>
      <div class="hint">Tip: leave “Total Monthly Views” at 0 to use Accounts × Posts × Views/Post. Enter 0.01 for 1% (or 1 = 1%).</div>
    </section>

    <section class="card">
      <h2>Offers (Add / Remove freely)</h2>
      <table class="table" id="offerTable">
        <thead>
          <tr><th style="width:40%">Offer name</th><th style="width:20%">AOV (£)</th><th style="width:20%">Mix %</th><th style="width:20%"></th></tr>
        </thead>
        <tbody id="offersBody">
          <!-- rows injected -->
        </tbody>
      </table>
      <div class="toolbar">
        <button id="addOffer">+ Add Offer</button>
      </div>
      <div class="hint">Mix % auto-normalises. Delete rows any time — calculations update live.</div>
    </section>
  </div>

  <section class="card" style="margin-top:16px">
    <h2>Results</h2>
    <div class="kpis">
      <div class="kpi"><div class="label">Total Posts / Month</div><div class="val" id="k_posts">—</div></div>
      <div class="kpi"><div class="label">Total Monthly Views</div><div class="val" id="k_views">—</div></div>
      <div class="kpi"><div class="label">Clicks</div><div class="val" id="k_clicks">—</div></div>
      <div class="kpi"><div class="label">Orders</div><div class="val" id="k_orders">—</div></div>
      <div class="kpi"><div class="label">Blended AOV</div><div class="val" id="k_aov">—</div></div>
      <div class="kpi"><div class="label">£ per 1,000 Views</div><div class="val" id="k_rpmv">—</div></div>
      <div class="kpi" style="grid-column:1/-1"><div class="label">Revenue (Total)</div><div class="val" id="k_revenue">—</div></div>
    </div>

    <table class="table" style="margin-top:12px">
      <thead><tr><th>Offer</th><th>Mix % (normalised)</th><th>Orders</th><th>AOV (£)</th><th>Revenue</th></tr></thead>
      <tbody id="breakdownBody"></tbody>
      <tfoot>
        <tr><th>Total</th><th id="mixTotal">100%</th><th id="ordersTotal">—</th><th id="aovBlend">—</th><th id="revTotal">—</th></tr>
      </tfoot>
    </table>
  </section>
</div>

<script>
  const gbp = n => new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP',maximumFractionDigits:2}).format(n||0);
  const int = n => new Intl.NumberFormat('en-GB').format(Math.round(n||0));
  const E = id => document.getElementById(id);

  // ---- Offer rows ----
  function getOffers() {
    const rows = [...document.querySelectorAll('#offersBody tr')];
    return rows.map(r => ({
      name: r.querySelector('.name').value.trim() || 'Offer',
      aov:  parseFloat(r.querySelector('.aov').value)  || 0,
      mix:  parseFloat(r.querySelector('.mix').value)  || 0,
      row:  r
    }));
  }
  function addOfferRow(data={name:'New Offer', aov:10, mix:33}) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="name" type="text" value="${data.name}"></td>
      <td><input class="aov" type="number" step="0.01" value="${data.aov}"></td>
      <td><input class="mix" type="number" step="0.1" value="${data.mix}"></td>
      <td style="text-align:right"><button class="del">Delete</button></td>
    `;
    tr.querySelectorAll('input').forEach(i => ['input','change'].forEach(evt => i.addEventListener(evt, compute)));
    tr.querySelector('.del').addEventListener('click', () => { tr.remove(); compute(); });
    E('offersBody').appendChild(tr);
    compute();
  }

  // ---- Maths ----
  function pct(val){
    let v = parseFloat(val);
    if(!isFinite(v)) return 0;
    if(v>1) v = v/100; // allow 1 = 1%
    return Math.max(0,v);
  }
  function compute(){
    const accounts = parseFloat(E('accounts').value)||0;
    const ppm      = parseFloat(E('ppm').value)||0;
    const vpp      = parseFloat(E('viewsPerPost').value)||0;
    const mv       = parseFloat(E('monthlyViews').value)||0;
    const ctr      = pct(E('ctr').value);
    const cvr      = pct(E('cvr').value);

    const posts = accounts * ppm;
    const views = mv>0 ? mv : posts * vpp;

    // Offers
    let offers = getOffers();
    if(offers.length===0){ // guard
      offers = [{name:'Default', aov:10, mix:100}];
      addOfferRow(offers[0]);
    }
    const mixSum = offers.reduce((s,o)=>s+(o.mix||0),0) || 1;
    offers.forEach(o=> o.norm = (o.mix||0)/mixSum);

    const blendedAOV = offers.reduce((s,o)=>s + o.aov*o.norm, 0);

    const clicks = views * ctr;
    const orders = clicks * cvr;
    const rpmv   = ctr * cvr * blendedAOV * 1000;
    const breakdown = offers.map(o=>{
      const ord = orders * o.norm;
      const rev = ord * o.aov;
      return {...o, ord, rev};
    });
    const revenue = breakdown.reduce((s,x)=>s+x.rev,0);

    // KPIs
    E('k_posts').textContent   = int(posts);
    E('k_views').textContent   = int(views);
    E('k_clicks').textContent  = int(clicks);
    E('k_orders').textContent  = orders.toFixed(2);
    E('k_aov').textContent     = gbp(blendedAOV);
    E('k_rpmv').textContent    = gbp(rpmv);
    E('k_revenue').textContent = gbp(revenue);

    // Table
    const body = E('breakdownBody'); body.innerHTML = '';
    breakdown.forEach(b=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${b.name}</td>
        <td>${(b.norm*100).toFixed(1)}%</td>
        <td>${b.ord.toFixed(2)}</td>
        <td>${gbp(b.aov)}</td>
        <td>${gbp(b.rev)}</td>
      `;
      body.appendChild(tr);
    });
    E('mixTotal').textContent   = '100%';
    E('ordersTotal').textContent= orders.toFixed(2);
    E('aovBlend').textContent   = gbp(blendedAOV);
    E('revTotal').textContent   = gbp(revenue);
  }

  // ---- Save/Load/Reset ----
  function save(){
    const state = {
      accounts:E('accounts').value,
      ppm:E('ppm').value,
      viewsPerPost:E('viewsPerPost').value,
      monthlyViews:E('monthlyViews').value,
      ctr:E('ctr').value,
      cvr:E('cvr').value,
      offers: getOffers().map(o=>({name:o.name,aov:o.aov,mix:o.mix}))
    };
    localStorage.setItem('repeats_calc_dynamic_v1', JSON.stringify(state));
    alert('Saved!');
  }
  function load(){
    const raw = localStorage.getItem('repeats_calc_dynamic_v1');
    if(!raw){ alert('No saved inputs found.'); return; }
    const s = JSON.parse(raw);
    ['accounts','ppm','viewsPerPost','monthlyViews','ctr','cvr'].forEach(k=>{ if(E(k) && s[k]!=null) E(k).value=s[k]; });
    E('offersBody').innerHTML='';
    (s.offers && s.offers.length ? s.offers : [
      {name:'Offer 1 — BOGO', aov:10, mix:35},
      {name:'Offer 2 — Bundle Builder', aov:28, mix:40},
      {name:'Offer 3 — 3-for-£25', aov:25, mix:25},
    ]).forEach(addOfferRow);
    compute();
  }
  function reset(){
    E('accounts').value=6; E('ppm').value=60; E('viewsPerPost').value=10000; E('monthlyViews').value=0;
    E('ctr').value=0.01; E('cvr').value=0.02;
    E('offersBody').innerHTML='';
    [
      {name:'Offer 1 — BOGO', aov:10, mix:35},
      {name:'Offer 2 — Bundle Builder', aov:28, mix:40},
      {name:'Offer 3 — 3-for-£25', aov:25, mix:25},
    ].forEach(addOfferRow);
    compute();
  }

  // Events
  ['accounts','ppm','viewsPerPost','monthlyViews','ctr','cvr'].forEach(id=>{
    E(id).addEventListener('input', compute);
    E(id).addEventListener('change', compute);
  });
  E('addOffer').addEventListener('click', ()=> addOfferRow({name:'New Offer', aov:20, mix:10}));
  E('save').addEventListener('click', save);
  E('load').addEventListener('click', load);
  E('reset').addEventListener('click', reset);

  // Init
  reset();
</script>
</body>
</html>
